<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <title>Assinatura de Email - PVT Software</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafb;
        }
        
        .configurador {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(26, 54, 93, 0.08);
            margin-bottom: 30px;
            border: 1px solid rgba(26, 54, 93, 0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #fafbfc;
            box-sizing: border-box;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #1a365d;
            background: white;
            box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1);
        }
        
        .form-group input:invalid, .form-group select:invalid {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .required-indicator {
            color: #ef4444;
            font-weight: bold;
            margin-left: 2px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        
        .preview-container {
            max-width: 980px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(26, 54, 93, 0.08);
            border: 1px solid rgba(26, 54, 93, 0.1);
        }
        
        .info-card {
            max-width: 600px;
            margin: 0 auto 30px auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(26, 54, 93, 0.08);
            border: 1px solid rgba(26, 54, 93, 0.1);
            border-left: 4px solid #1a365d;
        }
        
        .info-card-content {
            padding: 24px;
        }
        
        .info-card h3 {
            color: #1a365d;
            margin: 0 0 10px 0;
            font-size: 18px;
            font-weight: bold;
        }
        
        .info-card p {
            color: #666;
            margin: 0;
            line-height: 1.5;
            font-size: 14px;
        }
        
        .info-card .highlight {
            color: #1a365d;
            font-weight: bold;
        }
        
        .signature-controls {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .signature-toggle {
            background: #f1f5f9;
            border-radius: 8px;
            padding: 4px;
            display: inline-flex;
            gap: 4px;
        }
        
        .signature-toggle button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background: transparent;
            color: #64748b;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .signature-toggle button.active {
            background: white;
            color: #1a365d;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .signature-toggle button img {
            height: 16px;
            width: 16px;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .botoes {
            text-align: center;
            margin-top: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #1a365d 0%, #2d4a66 100%);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 8px;
            margin: 5px;
            display: inline-block;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(26, 54, 93, 0.2);
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.3);
        }
        
        h2 {
            color: #1a365d;
            margin: 0 0 20px 0;
            font-size: 24px;
            font-weight: 600;
        }
        
        #signature-preview {
            border: 2px dashed #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            background: #fafbfc;
        }
    </style>
</head>
<body>
    <div class="configurador">
        <h2>üîß Configurar Assinatura</h2>
        
        <div class="form-group">
            <label for="nome">Nome: <span style="color: red;">*</span></label>
            <input type="text" id="nome" placeholder="Nome Colaborador" onchange="atualizarAssinatura()" required>
        </div>
        
        <div class="form-group">
            <label for="funcao">Fun√ß√£o: <span style="color: red;">*</span></label>
            <select id="funcao" onchange="atualizarAssinatura()" required>
                <option value="">Selecione fun√ß√£o</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="email">Email: <span style="color: red;">*</span></label>
            <input type="email" id="email" placeholder="colaborador@pvtsoftware.com.br" value="" onchange="atualizarAssinatura()" required>
        </div>
        
        <div class="form-group">
            <label for="celular">Celular: <span style="color: red;">*</span></label>
            <input type="text" id="celular" placeholder="(27) 99999-9999" value="" oninput="formatarCelular(this)" onchange="atualizarAssinatura()"  required>
        </div>
        
        <div class="form-group">
            <label for="telefone">Tel. Fixo:</label>
            <input type="text" id="telefone" placeholder="(27) 3333-3333" value="" oninput="formatarTelefone(this)" onchange="atualizarAssinatura()" >
        </div>
    </div>

    <div class="info-card">
        <h1 style="display: flex; justify-content: center;"> ‚ö†Ô∏è INSTRU√á√ïES </h1>
        <div class="info-card-content">
            <h3>üí° Como configurar corretamente</h3>
            <p>
                <strong>1.</strong> Preencha o formul√°rio acima<br>
                <strong>2.</strong> Escolha a vers√£o: <span class="highlight">Outlook Desktop (PNG)</span> ou <span class="highlight">Outlook Navegador (SVG)</span><br>
                <strong>3.</strong> Clique no bot√£o <span class="highlight">"Baixar Assinatura"</span>; o formato ser√° definido automaticamente conforme a aba selecionada (PNG para Desktop, SVG para Web).<br>
                <strong>4.</strong> Copie o link gerado abaixo<br>
                <strong>5.</strong> Siga as instru√ß√µes do PDF: <a href="./Guia de configura√ß√£o da assinatura outlook.pdf" target="_blank" class="highlight">Configurar assinatura</a>
            </p>
        </div>
    </div>

    <div class="preview-container">
        <h2>üëÅÔ∏è Preview</h2>
        
        <div class="signature-controls">
            <div class="signature-toggle">
                <button id="btn-desktop" class="active" onclick="trocarFormato('png')"><img src="imagens/outlook.png" alt="Outlook">Outlook Desktop</button>
                <button id="btn-web" onclick="trocarFormato('svg')"><img src="imagens/outlook.png" alt="Outlook">Outlook Navegador</button>
            </div>
        </div>
        
        <div class="form-group">
            <label for="link">Link gerado: <span style="color: red;">*</span></label>
            <input type="link" id="link" value="https://ojotape05.github.io" onchange="atualizarAssinatura()" required>
        </div>

        <div id="signature-preview"></div>
        
        <div class="botoes">
            <button class="btn" onclick="baixarAssinatura()">üìã Baixar Assinatura</button>
            <button class="btn" onclick="baixarHTML()">üìÅ Download HTML</button>
        </div>
    </div>

    <script>
        let tipoAssinatura = 'simples';
        let tipoFormato = 'png';
        let whatsapp = '';
        let telefone_formatado = '';

        function capitalizeFirstLetter(val) {
            return String(val).charAt(0).toUpperCase() + String(val).slice(1);
        }

        function getFuncoesOptions() {
            const selectFuncao = document.getElementById('funcao')
            
            // Verificar se o elemento existe
            if (!selectFuncao) {
                console.error('Elemento com ID "select" n√£o encontrado')
                return
            }
            
            const listaFuncoes = [
                "Administrativo",
                "CEO",
                "Head de Servi√ßos",
                "Head de Opera√ß√µes Administrativas",
                "Gestor de Portf√≥lio de Projetos",
                "Coordenador de Projetos",
                "PMO",
                "Consultor de Implanta√ß√£o",
                "Desenvolvedor",
                "Consultor de Relacionamento com Cliente (CX)",
                "Executivo de Contas",
                "Gestor Administrativo",
                "Recursos e Aloca√ß√µes",
                "Analista de Faturamento",
                "Gente & Gest√£o"
            ]

            // Limpar op√ß√µes existentes (exceto a primeira, se houver)
            selectFuncao.innerHTML = ''
            
            // Adicionar op√ß√£o padr√£o (opcional)
            const defaultOption = document.createElement('option')
            defaultOption.value = ''
            defaultOption.textContent = 'Selecione uma fun√ß√£o'
            defaultOption.disabled = true
            defaultOption.selected = true
            selectFuncao.appendChild(defaultOption)

            // Usar forEach ao inv√©s de map e adicionar as op√ß√µes ao select
            listaFuncoes.forEach((funcao) => {
                const option = document.createElement('option')
                option.value = funcao
                option.textContent = funcao
                selectFuncao.appendChild(option) // Esta linha estava faltando!
            })
        }

        getFuncoesOptions()

        function getColaboradorInfos() {
            const nome = document.getElementById('nome').value;
            const funcao = document.getElementById('funcao').value;
            const email = document.getElementById('email').value;
            const celular = document.getElementById('celular').value;
            const telefone = document.getElementById('telefone').value;
        
            return { nome, funcao, email, celular, telefone, whatsapp }
        }

        function gerarLink() {
            const campoLink = document.getElementById('link')
            const url = new URL('https://ojotape05.github.io/')
            const params = new URLSearchParams(url.search)

            const { email, whatsapp, telefone } = getColaboradorInfos()

            params.append('whatsapp', whatsapp)
            params.append('email', email)
            if(telefone_formatado !== ''){
                params.append('telefone', telefone_formatado)
            }

            const newUrl = `${url}?${params}`

            campoLink.value = newUrl
        }
        
        // Fun√ß√£o para formatar celular (27) 99999-9999
        function formatarCelular(input) {
            let valor = input.value.replace(/\D/g, ''); // Remove todos os caracteres n√£o num√©ricos
            
            // Limitar a 11 d√≠gitos
            if (valor.length > 11) {
                valor = valor.substring(0, 11);
            }
            
            // Se n√£o tem nenhum d√≠gito, deixa vazio
            if (valor.length === 0) {
                input.value = '';
                return;
            }
            
            // Aplicar formata√ß√£o baseada no tamanho
            if (valor.length <= 2) {
                input.value = `(${valor}`;
            } else if (valor.length <= 7) {
                input.value = `(${valor.substring(0, 2)}) ${valor.substring(2)}`;
            } else {
                input.value = `(${valor.substring(0, 2)}) ${valor.substring(2, 7)}-${valor.substring(7)}`;
            }
            

            atualizarWhatsapp();

        }
        
        // Fun√ß√£o para formatar telefone fixo (27) 3333-3333
        function formatarTelefone(input) {
            let valor = input.value.replace(/\D/g, ''); // Remove todos os caracteres n√£o num√©ricos
            
            // Limitar a 10 d√≠gitos
            if (valor.length > 10) {
                valor = valor.substring(0, 10);
            }
            
            // Se n√£o tem nenhum d√≠gito, deixa vazio
            if (valor.length === 0) {
                input.value = '';
                return;
            }
            
            // Aplicar formata√ß√£o baseada no tamanho
            if (valor.length <= 2) {
                input.value = `(${valor}`;
            } else if (valor.length <= 6) {
                input.value = `(${valor.substring(0, 2)}) ${valor.substring(2)}`;
            } else {
                input.value = `(${valor.substring(0, 2)}) ${valor.substring(2, 6)}-${valor.substring(6)}`;
            }
        }
        
        function gerarAssinaturaCompleta() {

            const { nome, funcao, email, celular, telefone, whatsapp } = getColaboradorInfos()
            
            let telefones = [];
            if (celular) telefones.push(celular);
            if (telefone && telefone !== celular) telefones.push(telefone);
            const telefonesTexto = telefones.join(' / ');
            
            const whatsappClean = whatsapp.replace(/\D/g, '');
     
            return `<div id="assinatura-simples" style="background-image: url('https://raw.githubusercontent.com/pedromedev/pvt-imagens/master/imagens/Assinatura%20email%20PVT-3.png');background-size: cover;background-repeat: no-repeat;background-position: center;height: 118px;width: 510px;font-family: 'Roboto', Arial, sans-serif;position: relative;margin: 0 auto;">
                        <div style="position: absolute;left: 34%;top: 15%;width: 43%;max-width: 38%;height: 80%;display: flex;flex-direction: column;justify-content: space-between;">
                            <div style="display: flex;flex-direction: column;margin-bottom: 2px;">
                                <span style="color: #000000;font-weight: bold;font-size: 14.2px;margin-bottom: 0.5;">${nome.toUpperCase()}</span>
                                <span style="color: #505050;font-size: 9.2px;">${capitalizeFirstLetter(funcao)}</span>
                            </div>
                            
                            <div style="color: #505050;font-size: 9.2px;line-height: 1.4;gap: 0;">
                                <div>
                                    <span>${celular}</span> / <span>${telefone}</span>
                                </div>
                                <div>
                                    ${email}
                                </div>
                            </div>
                            
                            <div style="color: #505050;font-size: 9.2px;">
                                <span>https://pvtsoftware.com.br</span> <span>@pvtsoftware</span>
                            </div>
                        </div>
                    </div>`;
        }
                
        function gerarAssinaturaSimples() {
            const { nome, funcao, email, celular, telefone, whatsapp } = getColaboradorInfos()
            
            let telefones = [];
            if (celular) telefones.push(celular);
            if (telefone && telefone !== celular) telefones.push(telefone);
            const telefonesTexto = telefones.join(' / ');
            
            const whatsappClean = whatsapp.replace(/\D/g, '');

            return `<div id="assinatura-simples" style="background-image: url('https://raw.githubusercontent.com/pedromedev/pvt-imagens/master/imagens/Assinatura%20email%20PVT-3.png');background-size: cover;background-repeat: no-repeat;background-position: center;height: 118px;width: 510px;font-family: 'Roboto', Arial, sans-serif;position: relative;margin: 0 auto;">
                        <div style="position: absolute;left: 34%;top: 15%;width: 66%;height: 80%;display: flex;flex-direction: column;justify-content: space-between;">
                            <div style="display: flex;flex-direction: column;margin-bottom: 8px;">
                                <span style="color: #000000;font-weight: bold;font-size: 13px;line-height: 1.2;white-space: nowrap;">${nome.toUpperCase()}</span>
                                <span style="color: #505050;font-size: 9.2px;margin-top: 2px;white-space: nowrap;">${capitalizeFirstLetter(funcao)}</span>
                            </div>
                            
                            <div style="color: #505050;font-size: 9.2px;line-height: 1.4;">
                                <div style="margin-bottom: 2px;">${celular}</div>
                                <div style="margin-bottom: 3px;">${email}</div>
                                <div style="display: flex;align-items: center;gap: 3px;">
                                    <span>üåê</span>
                                    <span>https://pvtsoftware.com.br</span>
                                </div>
                                <div style="display: flex;align-items: center;gap: 3px;margin-top: 2px;">
                                    <svg fill="#E4405F" width="10px" height="10px" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg" style="min-width: 10px;"><path d="M20.445 5h-8.891A6.559 6.559 0 0 0 5 11.554v8.891A6.559 6.559 0 0 0 11.554 27h8.891a6.56 6.56 0 0 0 6.554-6.555v-8.891A6.557 6.557 0 0 0 20.445 5zm4.342 15.445a4.343 4.343 0 0 1-4.342 4.342h-8.891a4.341 4.341 0 0 1-4.341-4.342v-8.891a4.34 4.34 0 0 1 4.341-4.341h8.891a4.342 4.342 0 0 1 4.341 4.341l.001 8.891z"/><path d="M16 10.312c-3.138 0-5.688 2.551-5.688 5.688s2.551 5.688 5.688 5.688 5.688-2.551 5.688-5.688-2.55-5.688-5.688-5.688zm0 9.163a3.475 3.475 0 1 1-.001-6.95 3.475 3.475 0 0 1 .001 6.95zM21.7 8.991a1.363 1.363 0 1 1-1.364 1.364c0-.752.51-1.364 1.364-1.364z"/></svg>
                                    <span> pvtsoftware</span>
                                </div>
                            </div>
                        </div>
                    </div>`;

        }
        
        function atualizarAssinatura() {
            const preview = document.getElementById('signature-preview');

            gerarLink()
            
            if (tipoAssinatura === 'completa') {
                preview.innerHTML = gerarAssinaturaCompleta();
            } else {
                preview.innerHTML = gerarAssinaturaSimples();
            }
        }
        
        function atualizarWhatsapp() {
            const { celular } = getColaboradorInfos()

            const celularNumeros = celular.replace(/\D/g, '');
            whatsapp= '55' + celularNumeros;

            atualizarAssinatura();
        }

        function atualizarTelefoneFormatado(){
            const { telefone } = getColaboradorInfos()

            const telefoneNumeros = telefone.replace(/\D/g, '');
            console.log(telefoneNumeros)
            if(telefoneNumeros !== '') {
                telefone_formatado= '55' + telefoneNumeros;  
            } else {
                telefone_formatado = ''
            }
            atualizarAssinatura();
        }
        
        function trocarAssinatura(tipo) {
            tipoAssinatura = tipo;
            const btnCompleta = document.getElementById('btn-completa');
            const btnSimples = document.getElementById('btn-simples');
            
            if (tipo === 'completa') {
                document.getElementById('telefone').required = true
                btnCompleta.classList.add('active');
                btnSimples.classList.remove('active');
            } else {
                document.getElementById('telefone').required = false
                btnCompleta.classList.remove('active');
                btnSimples.classList.add('active');
            }
            
            atualizarAssinatura();
        }

        function trocarFormato(formato) {
            tipoFormato = formato;
            const btnDesktop = document.getElementById('btn-desktop');
            const btnWeb = document.getElementById('btn-web');
            if (formato === 'png') {
                btnDesktop.classList.add('active');
                btnWeb.classList.remove('active');
            } else {
                btnDesktop.classList.remove('active');
                btnWeb.classList.add('active');
            }
        }
        
        function validarCamposObrigatorios() {

            const { nome, funcao, email, celular } = getColaboradorInfos()
            
            const camposVazios = [];
            
            if (!nome) camposVazios.push('Nome');
            if (!funcao) camposVazios.push('Fun√ß√£o');
            if (!email) camposVazios.push('Email');
            if (!celular) camposVazios.push('Celular');
            
            if (camposVazios.length > 0) {
                alert(`‚ö†Ô∏è Por favor, preencha os seguintes campos obrigat√≥rios:\n‚Ä¢ ${camposVazios.join('\n‚Ä¢ ')}`);
                return false;
            }
            
            // Validar formato do email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('‚ö†Ô∏è Por favor, insira um email v√°lido.');
                return false;
            }
            
            // Validar se o celular tem 11 d√≠gitos
            const celularNumeros = celular.replace(/\D/g, '');
            if (celularNumeros.length !== 11) {
                alert('‚ö†Ô∏è Por favor, insira um celular v√°lido com 11 d√≠gitos.');
                return false;
            }
            
            return true;
        }
        
        function copiarAssinatura() {
            if (!validarCamposObrigatorios()) {
                return;
            }
            
            const preview = document.getElementById('signature-preview');
            
            // Criar um elemento tempor√°rio para sele√ß√£o
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = preview.innerHTML;
            tempDiv.style.position = 'absolute';
            tempDiv.style.left = '-9999px';
            document.body.appendChild(tempDiv);
            
            // Selecionar o conte√∫do
            const range = document.createRange();
            range.selectNodeContents(tempDiv);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    alert('‚úÖ Assinatura copiada! Agora cole no seu cliente de email usando Ctrl+V');
                } else {
                    throw new Error('Comando de c√≥pia falhou');
                }
            } catch (err) {
                // Fallback para navegadores modernos
                navigator.clipboard.writeText(preview.innerHTML).then(() => {
                    alert('‚úÖ Assinatura copiada! Agora cole no seu cliente de email usando Ctrl+V');
                }).catch(() => {
                    alert('‚ùå Erro ao copiar. Tente selecionar a assinatura manualmente e copiar com Ctrl+C');
                });
            }
            
            // Limpar sele√ß√£o e remover elemento tempor√°rio
            selection.removeAllRanges();
            document.body.removeChild(tempDiv);
        }
        
        function baixarHTML() {
            if (!validarCamposObrigatorios()) {
                return;
            }
            
            const preview = document.getElementById('signature-preview');
            const htmlCompleto = `<!DOCTYPE html>
                                    <html>
                                    <head>
                                        <meta charset="UTF-8">
                                        <title>Assinatura PVT Software</title>
                                    </head>
                                    <body style="margin: 0; padding: 20px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
                                        ${preview.innerHTML}
                                    </body>
                                    </html>`;
            
            const blob = new Blob([htmlCompleto], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'assinatura-pvt.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            atualizarWhatsapp();
            atualizarTelefoneFormatado();
            atualizarAssinatura();
            
            // Listener para mudan√ßas no celular
            document.getElementById('celular').addEventListener('input', function() {
                atualizarWhatsapp();
            });

            // Listener para mudan√ßas no celular
            document.getElementById('telefone').addEventListener('input', function() {
                atualizarTelefoneFormatado();
            });
        });

       const createHighQualityImageBlob = async (element, quality = 2, format = 'png') => {
            const canvas = await html2canvas(element, {
                backgroundColor: '#ffffff',
                scale: quality,
                useCORS: true,
                logging: false
            });
            
            const finalCanvas = document.createElement('canvas');
            finalCanvas.width = element.offsetWidth;
            finalCanvas.height = element.offsetHeight;
            
            const ctx = finalCanvas.getContext('2d');
            ctx.imageSmoothingEnabled = true;
            ctx.imageSmoothingQuality = 'high';
            
            ctx.drawImage(canvas, 0, 0, finalCanvas.width, finalCanvas.height);
            
            const mimeType = format === 'jpg' ? 'image/jpeg' : 'image/png';
            const imageQuality = format === 'jpg' ? 0.95 : 1.0;
            
            return new Promise(resolve => 
                finalCanvas.toBlob(resolve, mimeType, imageQuality)
            );
        };

        async function baixarAssinatura() {

            if (!validarCamposObrigatorios()) {
                return;
            }

            const node = document.getElementById('assinatura-simples');
            node.style.margin = 0;

            try {
                if (tipoFormato === 'svg') {
                    const dataUrl = await htmlToImage.toSvg(node, {
                        cacheBust: true,
                        pixelRatio: 1,
                    });
                    saveAs(dataUrl, 'assinatura-email.svg');
                } else {
                    const dataUrl = await htmlToImage.toPng(node, {
                        cacheBust: true,
                        pixelRatio: 3,
                    });
                    saveAs(dataUrl, 'assinatura-email.png');
                }
            } catch (err) {
                console.error('Erro ao gerar imagem:', err);
            } finally {
                node.style.margin = 'auto';
            }
        }
    
       async function baixarAssinaturaPNGAlternativa() {
            if (!validarCamposObrigatorios()) {
                return;
            }
            
            // Corrigir a refer√™ncia ao elemento
            const preview = document.getElementById('signature-preview').firstElementChild;
            
            if (!preview) {
                alert('‚ö† Erro: Elemento da assinatura n√£o encontrado.');
                return;
            }

            try {
                // Importar html2canvas se necess√°rio
                if (typeof html2canvas === 'undefined') {
                    
                    await new Promise((resolve, reject) => {
                        script.onload = resolve;
                        script.onerror = reject;
                    });
                }
                
                const imageBlob = await createHighQualityImageBlob(preview, 2, 'png');
                const url = URL.createObjectURL(imageBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'assinatura-email.jpg';
                a.click();
                URL.revokeObjectURL(url);
                
            } catch (error) {
                console.error('Erro:', error);
                alert('‚ùå Erro ao baixar a imagem. Tente novamente.');
            }
        }

    </script>
    
</body>
</html>